<navbar icon="fa fa-fw fa-signal" title="智能分析">
    <ul class="nav pull-right">
        <li ng-show="dashboard.meta.fullscreen" class="dashnav-back-to-dashboard">
            <a ng-click="exitFullscreen()">
                返回到仪表盘
            </a>
        </li>
        <li ng-if="dashboard">
             <gf-time-picker dashboard="dashboard"></gf-time-picker>
        </li>
    </ul>
</navbar>
<div dash-editor-view class="time-picker"></div>

<div class="page-container">
    <guide guide-class="guide" need-host=true></guide>
    <div class="page-header">
        <h2>关联性分析</h2>
    </div>
    <form class="tidy-form-box" ng-if="isSingle">
        <div class="tidy-form">
            <ul class="tidy-form-list">
                <li class="tidy-form-item">
                    指标
                </li>
                <li>
                    <input type="text" class="tidy-form-input input-xlarge"
                        style="margin-right: 40px;"
                        ng-model='targetObj.metric'
                        spellcheck='false'
                        bs-typeahead-old="suggestMetrics"
                        placeholder="需要分析的指标" required/>
                </li>
            </ul>
        </div>
        <div class="tidy-form">
            <ul class="tidy-form-list">
                <li class="tidy-form-item">
                    机器标签
                </li>
                <li>
                    <input type="text" class="input-medium tidy-form-input ng-pristine ng-untouched ng-valid"
                        style="margin-right: 40px;"
                        spellcheck="false"
                        bs-typeahead-old="suggestTagHost"
                        data-min-length="0" data-items="100" ng-model="targetObj.host" placeholder="请键入主机名"
                        data-provide="typeahead">
                </li>
            </ul>
        </div>
        <button type="submit" class="btn btn-primary" ng-click="analysis()"><i class="fa fa-search"></i>开始分析</button>
    </form>

    <div class="main-view-container">
        <div class="grafana-row" ng-controller="RowCtrl" ng-repeat="(row_name, row) in dashboard.rows" row-height>

            <div class="row-control">
                <div class="row-control-inner">
                    <div class="row-close" ng-show="row.collapse" data-placement="bottom">
                        <div class="row-close-buttons">
                            <span class="row-button bgPrimary" ng-click="toggleRow(row)">
                                <i bs-tooltip="'Expand row'" data-placement="right" class="fa fa-caret-left pointer"></i>
                            </span>
                        </div>
                        <div class="row-text pointer" ng-click="toggleRow(row)" ng-bind="row.title | interpolateTemplateVars:this"></div>
                    </div>
                </div>

                <div class="panels-wrapper" ng-if="!row.collapse">
                    <div class="row-text pointer" ng-click="toggleRow(row)" ng-if="row.showTitle" ng-bind="row.title | interpolateTemplateVars:this"></div>

                    <div ng-repeat="(name, panel) in row.panels track by panel.id" class="panel" ng-class="{true: 'association-container'}[panel.id === 1]"
                        ui-draggable="!dashboardViewState.fullscreen" drag="panel.id"
                        ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                        <plugin-component type="panel" class="panel-margin"></plugin-component>
                        <cw-tree-menu ng-if="panel.id === 1"></cw-tree-menu>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>

        <div class="service-events" ng-if="serviceEvents.length">
            <h3>事件列表</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>名称</th><th>事件类型</th><th>发生时间</th><th>其他信息</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="event in serviceEvents">
                        <td>{{ event.service }}</td>
                        <td>{{ event.type }}</td>
                        <td>{{ event.timestamp }}</td>
                        <td>{{ event.hostname }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>