<navbar title="日志管理" icon="fa fa-fw fa-search">
  <ul class="nav">
      <li class="active"><a>日志规则</a></li>
  </ul>
</navbar>

<div class="page-container">
  <div class="page-header">
    <h1>新建日志规则</h1>
  </div>
  <br>
  <form class="gf-form-group">
    <div class="parse-form-group">
      <div class="gf-form">
        <span class="gf-form-label width-9">规则名称<em>*</em></span>
        <input class="gf-form-input max-width-21" type="text" required ng-model="ctrl.rule.ruleName" />
      </div>

      <div class="gf-form">
        <span class="gf-form-label width-9">服务<em>*</em></span>
        <select class="gf-form-input max-width-21" ng-options="s.name as s.name for s in ctrl.serviceList"
          ng-model="ctrl.rule.serviceName"></select>
        <input class="gf-form-input max-width-21" type="text" ng-if="ctrl.rule.serviceName === '其他'"
          ng-model="ctrl.custom.serviceName" placeholder="自定义服务名称" required />
      </div>

      <div class="gf-form">
        <span class="gf-form-label width-9">日志类型<em>*</em></span>
        <select class="gf-form-input max-width-21" ng-options="t for t in ctrl.rule.logTypes"
          ng-model="ctrl.rule.logType"></select>
        <input class="gf-form-input max-width-21" type="text" ng-if="ctrl.rule.logType === '其他'"
          ng-model="ctrl.custom.logType" placeholder="请输入英文字母" required />
        <button class="btn btn-primary" 
          ng-if="ctrl.rule.serviceName !== '其他' && ctrl.rule.logType !== '其他'">应用模板</button>
      </div>

      <div class="gf-form parse-form section">
        <span class="gf-form-label width-9">日志文件</span>
        <table class="table parse-table">
          <tr>
            <th>路径</th>
            <th>操作</th>
          </tr>
          <tr ng-repeat="path in ctrl.rule.paths">
            <td style="width: 50%;">
              <span ng-if="ctrl.editLogPath.index !== $index">{{path}}</span>
              <input style="width: 100%;" type="text" ng-class="{false: 'error-input'}[ctrl.checkInput(ctrl.editLogPath.path, 'logPath')]"
              placeholder="请输入日志路径"
              ng-if="ctrl.editLogPath.index === $index"
              ng-model="ctrl.editLogPath.path">
            </td>
            <td style="width: 50%;">
              <span ng-if="ctrl.editLogPath.index !== $index">
                <a class="parse-btn parse-edit" ng-click="ctrl.editLog($index, path);"><i class="fa fa-pencil"></i>修改</a>
                <a class="parse-btn parse-delete" ng-click="ctrl.deleteLog(path)"><i class="fa fa-times-circle"></i>删除</a>
              </span>
              <span ng-if="ctrl.editLogPath.index === $index">
                <button class="btn btn-outline-success" ng-click="ctrl.addLogPath('save')">保存</button>
                <button class="btn btn-outline-inverse" ng-click="ctrl.editLog(-1, '')">取消</button>
              </span>
            </td>
          </tr>
          <tr>
            <td style="width: 50%;">
              <input class="gf-form-input max-width-21" type="text" placeholder="请输入日志路径" ng-model="ctrl.newPath"
              ng-class="{false: 'error-input'}[ctrl.checkInput(ctrl.newPath, 'logPath') || !ctrl.newPath]"/>
            </td>
            <td style="width: 50%;">
              <a class="parse-btn parse-add" ng-click="ctrl.addLogPath('add')"><i class="fa fa-pencil"></i>添加</a>
            </td>
          </tr>
        </table>
      </div>

      <div class="gf-form parse-form">
        <span class="gf-form-label width-9">格式<em>*</em></span>
        <label class="multiline-label">
          <input type="radio" name="multiline" ng-value=false ng-model="ctrl.rule.multiline" />
          <span>单行</span>
        </label>
        <label class="multiline-label">
          <input type="radio" name="multiline" ng-value=true ng-model="ctrl.rule.multiline" />
          <span>多行</span>
        </label>
        <div class="multiline-box" ng-if="ctrl.rule.multiline">
          <span class="gf-form-label width-21">日志起始标识<em>*</em></span>
          <input class="gf-form-input width-30" type="text" ng-model="ctrl.rule.multilinePattern" placeholder="请输入日志起始匹配规则" required />
        </div>
      </div>
    </div>

    <div class="parse-form-group">
      <div class="gf-form parse-form section">
        <span class="gf-form-label width-9">解析器
          <a class="parse-btn parse-edit" ng-click="ctrl.editPattren()" style="margin-left: 10px;">
            <i class="fa fa-plus-square"></i>
          </a>
        </span>
        <table class="table parse-table">
          <tr>
            <th>解析器名称</th>
            <th>操作</th>
          </tr>
          <tr ng-repeat="pattern in ctrl.rule.patterns">
            <td style="width: 50%;"><span>{{pattern.name}}</span></td>
            <td style="width: 50%;">
              <a class="parse-btn parse-edit" ng-click="ctrl.editPattren(pattern)"><i class="fa fa-pencil"></i>修改</a>
              <a class="parse-btn parse-delete" ng-click="ctrl.deletePattern(pattern);"><i class="fa fa-times-circle"></i>删除</a>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div class="parse-form-group">
      <div class="gf-form parse-form section">
        <span class="gf-form-label width-9">部署</span>
        <table class="table parse-table">
          <tr>
            <th>机器名称</th>
            <th>操作</th>
          </tr>
          <tr ng-repeat="host in ctrl.rule.hosts">
            <td style="width: 50%;"><span>{{host}}</span></td>
            <td style="width: 50%;">
              <a class="parse-btn parse-delete"><i class="fa fa-times-circle"></i>删除</a>
            </td>
          </tr>
          <tr>
            <td style="width: 50%;">
              <input class="gf-form-input max-width-21" type="text" ng-model="ctrl.newHost"/>
            </td>
            <td style="width: 50%;">
              <a class="parse-btn parse-add"><i class="fa fa-pencil"></i>添加</a>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div class="parse-form-group no-border">
      <button class="btn btn-success">保存</button>
      <button class="btn btn-inverse">取消</button>
    </div>

  </form>
</div>