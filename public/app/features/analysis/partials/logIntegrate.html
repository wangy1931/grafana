<navbar icon="fa fa-fw fa-search" title="整合页面">
    <ul class="nav pull-right">
        <li ng-show="dashboard.meta.fullscreen" class="dashnav-back-to-dashboard">
            <a ng-click="exitFullscreen()">
                返回到仪表盘
            </a>
        </li>
        <li ng-if="dashboard">
            <gf-time-picker dashboard="dashboard"></gf-time-picker>
        </li>
    </ul>
</navbar>
<div dash-editor-view class="time-picker"></div>

<div class="page-container">
    <form>
        <input type="text" class="input-xlarge tight-form-input ng-pristine ng-untouched ng-valid ng-valid-required" ng-model="query" required="">
        <button type="submit" class="btn btn-primary" ng-click="reQuery()"><i class="fa fa-search"></i>查找</button>
    </form>
    <div class="grafana-row" ng-controller="RowCtrl"
        ng-repeat="(row_name, row) in dashboard.rows" row-height>

    <div class="row-control">
        <div class="row-control-inner">
        <div class="row-close" ng-show="row.collapse" data-placement="bottom" >
            <div class="row-close-buttons">
                <span class="row-button bgPrimary" ng-click="toggleRow(row)">
                <i bs-tooltip="'Expand row'" data-placement="right" class="fa fa-caret-left pointer" ></i>
                </span>
            </div>
            <div class="row-text pointer" ng-click="toggleRow(row)" ng-bind="row.title | interpolateTemplateVars:this"></div>
        </div>
        </div>

        <div class="panels-wrapper" ng-if="!row.collapse">
        <div class="row-text pointer" ng-click="toggleRow(row)" ng-if="row.showTitle" ng-bind="row.title | interpolateTemplateVars:this">
        </div>


        <div ng-repeat="(name, panel) in row.panels track by panel.id" class="panel" ui-draggable="!dashboardViewState.fullscreen" drag="panel.id"
                ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width   ng-if="panel.tab === graph">
            <plugin-component ng-if="type !== 'table'" type="panel" class="panel-margin"></plugin-component>
        </div>
        <div class="log-search-result">
            <tabset>
                <tab heading="{{panel.title}}" ng-repeat="(name, panel) in row.panels track by panel.id" ng-if="panel.tab !== graph">
                    <ul ng-if="panel.regularResult.data[0].total">
                        <li style="color: #F9934E; list-style-type: disc; margin-left: 30px;">
                            该时间区域内共有 <strong>{{panel.regularResult.data[0].total}}</strong> 条日志，当前显示前 {{panel.regularResult.data[0].datapoints.length}} 条。放大时间区域，以查看更细日志数据。
                        </li>
                    </ul>
                    <div ng-if="name == 2" class="log-compare">
                        <div class="btn-group btn-log-compare">对比日志：
                            <button class="dropdown-toggle" data-toggle="dropdown">
                                {{currentRelativeTime}}<span class="caret" style="vertical-align: middle; margin-left: 10px;"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li ng-click="logCompare('-1d')">1天以前</li>
                                <li ng-click="logCompare('-7d')">7天以前</li>
                                <li ng-click="logCompare('-30d')">1月以前</li>
                                <li ng-click="logCompare('-365d')">1年以前</li>
                                <li ng-click="showInputModal()">自定义</li>
                            </ul>
                        </div>
                        <div class="btn-group btn-log-filter">过滤条件：
                            <button class="dropdown-toggle" data-toggle="dropdown">
                                {{currentFilter}}<span class="caret" style="vertical-align: middle; margin-left: 10px;"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li ng-click="logFilter('')">无</li>
                                <li ng-click="logFilter('增加')">增加日志</li>
                                <li ng-click="logFilter('减少')">减少日志</li>
                                <li ng-click="logFilter('新增')">新增日志</li>
                                <li ng-click="logFilter('消失')">消失日志</li>
                            </ul>
                        </div>
                        <div>
                            <ul ng-if="name == 2">
                                <li style="color: #F9934E;">当前日志时间段： <strong>{{tabsCache[row.id].timeRange | formatTimeRange:'now':0}} 至 {{tabsCache[row.id].timeRange | formatTimeRange:'now':1}}</strong></li>
                                <li style="color: #F9934E;">对比日志时间段： <strong>{{tabsCache[row.id].timeRange | formatTimeRange:currentRelativeTime:0}} 至 {{tabsCache[row.id].timeRange | formatTimeRange:currentRelativeTime:1}}</strong></li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <plugin-component type="panel" class="panel-margin log-panel"></plugin-component>
                    </div>
                </tab>
            </tabset>
        </div>

        <div class="clearfix"></div>
        </div>
    </div>
    </div>
</div>
