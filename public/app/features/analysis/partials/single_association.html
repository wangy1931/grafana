<navbar icon="fa fa-fw fa-signal" title="关联分析">
    <ul class="nav pull-right">
        <li ng-show="dashboard.meta.fullscreen" class="dashnav-back-to-dashboard">
            <a ng-click="exitFullscreen()">
                返回到仪表盘
            </a>
        </li>
        <li ng-if="dashboard">
            <gf-time-picker dashboard="dashboard"></gf-time-picker>
        </li>
    </ul>
</navbar>

<div class="page-container" style="background:#fff;">
    <form class="tidy-form-box">
        <h2>关联性分析</h2>
        <div class="tidy-form">
            <ul class="tidy-form-list">
                <li class="tidy-form-item" style="width: 100px">
                    指标
                </li>
                <li>
                    <!--input placeholder="需要分析的指标" ng-model="targetObj.metric" type="text" required class="input-xxlarge tidy-form-input last" -->
                    <input type="text" class="tidy-form-input input-xlarge"
                           ng-model='targetObj.metric'
                           spellcheck='false'
                           bs-typeahead-old="suggestMetrics"
                           placeholder="需要分析的指标" required/>
                </li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <div class="tidy-form">
            <ul class="tidy-form-list">
                <li class="tidy-form-item" style="width: 100px">
                    机器标签
                </li>
                <li>
                    <input type="text" class="input-medium tidy-form-input ng-pristine ng-untouched ng-valid"
                           spellcheck="false"
                           bs-typeahead-old="suggestTagHost"
                           data-min-length="0" data-items="100" ng-model="targetObj.host" placeholder="请键入主机名"
                           data-provide="typeahead">
                </li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <button type="submit" class="btn btn-primary" ng-click="analysis()"><i class="fa fa-search"></i>开始分析</button>
    </form>
    <div ng-if="dashboard">
        <h2>调整相关性分析参数</h2>
        <table class="grafana-options-table">
            <tr>
                <td><strong>调整阈值</strong></td>
                <td width="400px">
                    <div class="sliders" slider></div>
                </td>
                <td>
          <span ng-click="resetCorrelationAnalysis()" class="btn btn-primary">
            <i class="fa fa-edit"></i>过滤结果
          </span>
                </td>
            </tr>
        </table>
    </div>
    <p ng-if="!isAssociation && status">没有关联结果？调整下阈值试试吧。还是没有？请点击右侧按钮试试。<button class="btn btn-small btn-primary" ng-click="flushResult()">刷新结果</button></p>
    <div class="main-view-container">
        <div class="grafana-row" ng-controller="RowCtrl"
            ng-repeat="(row_name, row) in dashboard.rows" row-height>

            <div class="row-control">
                <div class="row-control-inner">
                    <div class="row-close" ng-show="row.collapse" data-placement="bottom">
                        <div class="row-close-buttons">
                                <span class="row-button bgPrimary" ng-click="toggleRow(row)">
                                    <i bs-tooltip="'Expand row'" data-placement="right"
                                    class="fa fa-caret-left pointer"></i>
                                </span>
                        </div>
                        <div class="row-text pointer" ng-click="toggleRow(row)"
                            ng-bind="row.title | interpolateTemplateVars:this"></div>
                    </div>
                </div>

                <div class="panels-wrapper" ng-if="!row.collapse">
                    <div class="row-text pointer" ng-click="toggleRow(row)" ng-if="row.showTitle"
                        ng-bind="row.title | interpolateTemplateVars:this">
                    </div>

                    <div ng-repeat="(name, panel) in row.panels track by panel.id" class="panel"
                        ui-draggable="!dashboardViewState.fullscreen" drag="panel.id"
                        ui-on-Drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                        <plugin-component type="panel" class="panel-margin"></plugin-component>
                    </div>

                    <div ng-if="isAssociation" class="panel panel-associatoin"
                        style="padding: 20px 20px 20px 20px;">
                        <h2>
                            挑选推荐关联指标进行对比
                            <span ng-click="showNewAssociationManual()" class="btn btn-primary">
                                <i class="fa fa-add"></i>新增任意指标
                            </span>
                            <span ng-click="addRCA()" class="btn btn-success">添加选中关联信息至RCA</span>
                        </h2>
                        <p ng-if="correlatedMetrics.length">尝试将阈值调大, 匹配更多关联指标</p>
                        <div class="panel grafana-options-table">
                            <div controls controls-row>
                                <table class="table">
                                    <tr>
                                        <th>根源指标</th>
                                        <th>关联程度</th>
                                    </tr>
                                    <tr ng-repeat="ralation in ralationMetrics">
                                        <td>
                                            <label class="span3 checkbox">
                                                <input type="checkbox" ng-model="ralation.checked" ng-click="addQuery(ralation.metric)" />
                                                <p style="width: 90%;" class="max-width" title="{{_.getMetricName(ralation.metric)}}">
                                                    {{_.getMetricName(ralation.metric)}}</p>
                                            </label>
                                        </td>
                                        <td>
                                            <div class="gf-form max-width-28">
                                            <label class="gf-form-inline">
                                                <input class="gf-form-input" type="radio" name="{{_.getMetricName(ralation.metric)}}" value="100" ng-model="ralation.confidenceLevel"/>
                                                <span class="gf-form-label gf-form-label-radio">相关</span>
                                            </label>
                                            <label class="gf-form-inline">
                                                <input class="gf-form-input" type="radio" name="{{_.getMetricName(ralation.metric)}}" value="50" ng-model="ralation.confidenceLevel"/>
                                                <span class="gf-form-label gf-form-label-radio">一般</span>
                                            </label>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>
</div>
