<navbar icon="fa fa-fw fa-cloud-download" title="安装指南" title-url="/setting/agent">
  <ul class="nav">
      <li><a href="/setting/agent">安装探针</a></li>
      <li><a href="/setting/service">安装服务</a></li>
      <li class="active"><a href="/setting/filebeat">日志收集配置</a></li>
  </ul>
</navbar>
<div class="page-container">
  <h2>日志收集配置<span style="font-size:14px; margin-left:20px;">* 注意: 请严格按照参考实例格式</span></h2>
  <h4>1. 修改日志配置文件</h4>
  <ul style="list-style:none;">
    <li>
      <p style="word-break: break-all">查找配置文件</p>
      <div class="tight-form last">
        <p class="code-block">/opt/cloudwiz-agent/filebeat-1.3.1/filebeat.yml</p>
      </div>
      <p style="word-break: break-all">修改配置文件</p>
      <div class="tight-form last">
        <p class="code-block">filebeat:</p>
        <p class="code-block indent2"># 获取探针列表.</p>
        <p class="code-block indent2">prospectors:</p>
        <p class="code-block indent4"># 每一个都是一个日志探针,以下是日志探针的配置详情.</p>
        <p class="code-block indent4 bold"># 注意: Cloudwiz将以第一个日志探针来监测您所安装的Cloudwiz所提供的机器及服务探针的运行日志,请勿修改. 如需自己监测日志，请在下方添加新的日志探针</p>
        <p class="code-block indent4">-</p>
        <p class="code-block indent6">paths:</p>
        <p class="code-block indent8"> - /opt/cloudwiz-agent/altenv/var/log/collector.log</p>
        <p class="code-block indent6">input_type: log</p>
        <p class="code-block indent6">document_type: collector</p>
        <p class="code-block indent6">fields:</p>
        <p class="code-block indent8">token: "571145dfa339dc049c7467475cf82b1b115bca00"</p>
        <p class="code-block indent6">fields_under_root: true</p>
        <p class="code-block indent6">close_older: 2h</p>
        <p class="code-block indent6">multiline:</p>
        <p class="code-block indent8">pattern: '^[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2},[0-9]{3}'</p>
        <p class="code-block indent8">negate: true</p>
        <p class="code-block indent8">match: after</p>
        <p class="code-block indent4 bold">- # 如需自己监测日志，请在此添加新的日志探针,注意: 请勿删除"-"符号</p>
        <p class="code-block indent6 bold">paths:</p>
        <p class="code-block indent8 bold"> - /test.log # 此处请填写日志所在的绝对路径</p>
        <p class="code-block indent6 bold">input_type: log # 请勿修改 </p>
        <p class="code-block indent6 bold">document_type: collector # 请根据需要进行更改,不同的程序的日志,不同的配置</p>
        <p class="code-block indent6 bold">fields:</p>
        <p class="code-block indent8 bold"> # 注意: 此处的token为识别您的公司系统的token,请区别于以上token</p>
        <p class="code-block indent8 bold">token: "{{token}}"</p>
        <p class="code-block indent6 bold">fields_under_root: true # 请勿修改</p>
        <p class="code-block indent6 bold">close_older: 2h # 请勿修改</p>
        <p class="code-block indent6 bold">multiline:</p>
        <p class="code-block indent8 bold">pattern: '' #此处请填写匹配相应日志头的正则表达式,也可以使用grok pattern</p>
        <p class="code-block indent8 bold">negate: true # 请勿修改</p>
        <p class="code-block indent8 bold">match: after # 请勿修改</p>
      </div>
    </li>
  </ul>

  <h4>2. 相关操作<span style="font-size:12px; margin-left:20px;">* 注意: 执行以下操作需要root权限</span></h4>
  <ul style="list-style:lower-roman;">
    <li>
      <p style="word-break: break-all">完成以上配置后,请重启filebeat</p>
      <div class="tight-form last">
        <p  class="code-block">/opt/cloudwiz-agent/altenv/bin/supervisorctl restart cloudwiz-agent:filebeat</p>
      </div>
    </li>
    <li>
      <p style="word-break: break-all">完成安装启动后,您可以检查其状态</p>
      <div class="tight-form last">
        <p  class="code-block">/opt/cloudwiz-agent/altenv/bin/supervisorctl status</p>
      </div>
      <p style="word-break: break-all">如果显示以下信息,则说明配置成功</p>
      <div class="tight-form last">
        <p  class="code-block">cloudwiz-agent:collector         RUNNING   pid 4818, uptime 5 days, 15:32:59</p>
        <p  class="code-block bold">cloudwiz-agent:filebeat          RUNNING   pid 45495, uptime 3 days, 20:14:35
        <p  class="code-block">cloudwiz-agent:uagent            RUNNING   pid 4817, uptime 5 days, 15:32:59</p>
      </div>
    </li>
    <li>
      <p style="word-break: break-all">停止</p>
      <div class="tight-form last">
        <p class="code-block">/opt/cloudwiz-agent/altenv/bin/supervisorctl stop cloudwiz-agent:filebeat</p>
      </div>
    </li>
    <li>
      <p style="word-break: break-all">启动</p>
      <div class="tight-form last">
        <p class="code-block">/opt/cloudwiz-agent/altenv/bin/supervisorctl start cloudwiz-agent:filebeat</p>
      </div>
    </li>
  </ul>

  <h4>3. 了解更多</h4>
  <p>如果您想了解更多关于filebeat的相关信息，
    <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-options.html" target="_blank" style="color:blue">请点击这里</a>
  </p>

</div>

