<div ng-include="'public/app/partials/login_header.html'"></div>
<div ng-controller="SystemCtrl" ng-init="init_system_choice()" class="page-container system-container">
  <h3>管理员 {{contextSrv.user.name}} 欢迎您！请选择系统进入>></h3>

    <div class="system-list" ng-if="!systems.length" ng-click="newSystem()"><h4>您尚未拥有系统,请点击这里添加系统</h4></div>
    <system-panel ng-repeat="sys in systems" ng-show="sys.OrgId === contextSrv.user.orgId" sys="{{sys.Id}}" ng-click="enter(sys.Id)">
      <div class="system-list">
        <div ng-show="hostList.length">
            <h2 class="system-item">{{sys.SystemsName}}<br>健康值{{health}}%</h2>  
        
            <div class="system-item">
                <h4>报警状态(个数)</h4>
                <p>{{alertNum}}</p>
                <div class="system-item-pie" sys_alert="{{sys.Id}}"></div>
                <div class="system-item-legend">
                    <dl class="small-dl">
                        <dt><span class="system-label system-label-success">正常</span></dt>
                        <dd class="system-legend system-legend-success">{{alertNum - warn - critical}}</dd>
                    </dl>
                    <dl class="small-dl">
                        <dt><span class="system-label system-label-warning">警告</span></dt>
                        <dd class="system-legend system-legend-warning">{{warn}}</dd>
                    </dl>
                    <dl class="small-dl">
                        <dt><span class="system-label system-label-danger">严重</span></dt>
                        <dd class="system-legend system-legend-danger">{{critical}}</dd>
                    </dl>
                </div>
                <div class="clearfix"></div>
            </div>

            <div class="system-item">
                <h4>自动异常检测(个数)</h4>
                <p>{{numMetrics}}</p>
                <div class="system-item-pie" sys_annomaly="{{sys.Id}}"></div>
                <div class="system-item-legend">
                    <dl>
                        <dt><span class="system-label system-label-success">正常指标</span></dt>
                        <dd class="system-legend system-legend-success">{{numMetrics - numAnomalyMetrics}}</dd>
                    </dl>
                    <dl>
                        <dt><span class="system-label system-label-warning">异常指标</span></dt>
                        <dd class="system-legend system-legend-warning">{{numAnomalyMetrics}}</dd>
                    </dl>
                </div>
                <div class="clearfix"></div>
            </div>

            <div class="system-item">
                <h4>服务状态(个数)</h4>
                <p>{{servies.length}}</p>
                <div style="width:70%; margin:0 auto;">
                    <div class="system-status-box pull-left">
                        <span class="system-label system-label-success">正常</span>
                        <span class="system-legend system-legend-success">{{serviesStatus.normal}}</span>
                    </div>
                    <div class="system-status-box pull-right">
                        <span class="system-label system-label-warning">异常</span>
                        <span class="system-legend system-legend-warning">{{serviesStatus.unnormal}}</span>
                    </div>
                    <div class="clearfix"></div>
                    <div ng-if="servies.length" class="system-status-percent">
                        <span style="width: {{serviesStatus.normal / servies.length * 100}}%;">{{serviesStatus.normal / servies.length * 100 |limitTo:4}}%</span>
                        <span style="width: {{serviesStatus.unnormal / servies.length * 100}}%;">{{serviesStatus.unnormal / servies.length * 100 |limitTo:4}}%</span>
                    </div>
                    <div ng-if="!servies.length" class="system-status-percent">
                        暂无服务状态
                    </div>
                    <div class="status-list">
                        <div class="status-normal" style="width: {{serviesStatus.normal / servies.length * 100}}%;">
                            <span ng-repeat="status in servies | filter:{'alive': 0}">{{status.service}}</span>
                        </div>
                        <div class="status-unnormal" style="width: {{serviesStatus.unnormal / servies.length * 100}}%;">
                            <span ng-repeat="status in servies" ng-if="status.alive !== 0">{{status.service}}</span>
                        </div>
                    </div>
                    <div ng-if="servies.length">查看详情</div>
                </div>
            </div>

            <div class="system-item">
                <h4>机器连接状态(个数)</h4>
                <p>{{hostList.length}}</p>
                <div style="width: 70%; margin:0 auto;">
                    <div class="system-status-box pull-left">
                        <span class="system-label system-label-success">正常</span>
                        <span class="system-legend system-legend-success">{{hostStatus.normal}}</span>
                    </div>
                    <div class="system-status-box pull-right">
                        <span class="system-label system-label-warning">异常</span>
                        <span class="system-legend system-legend-warning">{{hostStatus.unnormal}}</span>
                    </div>
                    <div class="clearfix"></div>
                    <div ng-if="hostList.length" class="system-status-percent">
                        <span style="width: {{hostStatus.normal / hostList.length * 100}}%;">{{hostStatus.normal / hostList.length * 100 | limitTo:4}}%</span>
                        <span style="width: {{hostStatus.unnormal / hostList.length * 100}}%;">{{hostStatus.unnormal / hostList.length * 100 | limitTo:4}}%</span>
                    </div>
                    <div ng-if="!hostList.length" class="system-status-percent">
                        暂无机器连接状态
                    </div>
                    <div class="status-list">
                        <div class="status-normal"  style="width: {{hostStatus.normal / hostList.length * 100}}%;">
                            <span ng-repeat="status in hostList | filter:{'collector.state': 0}">{{status.hostname}}</span>
                        </div>
                        <div class="status-unnormal" style="width: {{hostStatus.unnormal / hostList.length * 100}}%;">
                            <span ng-repeat="status in hostList" ng-if="status['collector.state'] !== 0">{{status.hostname}}</span>
                        </div>
                    </div>
                </div>
                <div ng-if="hostList.length">查看详情</div>
            </div>
            <br/>
        </div>
        <div class="clearfix"></div>
        <div ng-if="!hostList.length">
            <h4>{{sys.SystemsName}} 请安装机器探针</h4>
            <div>
                <div ng-repeat="host in platform" class="pull-left" style="width:25%;margin-top:10px;">
                    <i class="{{host.icon}}"></i>
                    <p>{{host.host}}</p>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
      </div>
    </system-panel>
</div>